<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/Workshop/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=Workshop/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.147.9">
    <meta name="description" content="MyWorkshop">
<meta name="author" content="virutsetup@gmail.com">

    <link rel="icon" href="/Workshop/images/img/imgfavicon.png" type="image/png">

    <title>Training model :: Tạo mới tài khoản AWS</title>

    
    <link href="/Workshop/css/nucleus.css?1754890544" rel="stylesheet">
    <link href="/Workshop/css/fontawesome-all.min.css?1754890544" rel="stylesheet">
    <link href="/Workshop/css/hybrid.css?1754890544" rel="stylesheet">
    <link href="/Workshop/css/featherlight.min.css?1754890544" rel="stylesheet">
    <link href="/Workshop/css/perfect-scrollbar.min.css?1754890544" rel="stylesheet">
    <link href="/Workshop/css/auto-complete.css?1754890544" rel="stylesheet">
    <link href="/Workshop/css/atom-one-dark-reasonable.css?1754890544" rel="stylesheet">
    <link href="/Workshop/css/theme.css?1754890544" rel="stylesheet">
    <link href="/Workshop/css/hugo-theme.css?1754890544" rel="stylesheet">
    
    <link href="/Workshop/css/theme-workshop.css?1754890544" rel="stylesheet">
    
    

    <script src="/Workshop/js/jquery-3.3.1.min.js?1754890544"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/Workshop/vi/4.-transformers/4.3-training-model/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/Workshop/js/lunr.min.js?1754890544"></script>
<script type="text/javascript" src="/Workshop/js/auto-complete.js?1754890544"></script>
<script type="text/javascript">
    
    
    
</script>
<script type="text/javascript" src="/Workshop/js/search.js?1754890544"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/Workshop/vi/1.-introduction/" title="1. Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/1.-introduction/">
          1. Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/Workshop/vi/2.-prepare/" title="2. Chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/2.-prepare/">
          2. Chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/2.-prepare/2.1-create-s3-bucket/" title="Tạo Amazon S3 bucket" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/2.-prepare/2.1-create-s3-bucket/">
          <b>2.1</b>Tạo Amazon S3 bucket
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/2.-prepare/2.2-create-csv-file/" title="Chuẩn bị và tải tệp CSV lên S3" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/2.-prepare/2.2-create-csv-file/">
          <b>2.2</b>Chuẩn bị và tải tệp CSV lên S3
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/2.-prepare/2.3-upload-csv-to-s3-bucket/" title="Upload CSV lên S3" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/2.-prepare/2.3-upload-csv-to-s3-bucket/">
          <b>2.3</b>Upload CSV lên S3
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/2.-prepare/2.4-set-iam-policy/" title="Cấu hình quyền IAM" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/2.-prepare/2.4-set-iam-policy/">
          <b>2.4</b>Cấu hình quyền IAM
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/Workshop/vi/3.-aws-comprehend/" title="3. AWS Comprehend" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/3.-aws-comprehend/">
          3. AWS Comprehend
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/3.-aws-comprehend/3.1-demo-aws-comprehend/" title="Demo sơ bộ AWS Comprehend" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/3.-aws-comprehend/3.1-demo-aws-comprehend/">
          <b>3.1</b>Demo sơ bộ AWS Comprehend
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/3.-aws-comprehend/3.2-create-lambda-function/" title="Tạo hàm lambda xử lý file CSV" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/3.-aws-comprehend/3.2-create-lambda-function/">
          <b>3.2</b>Tạo hàm lambda xử lý file CSV
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/Workshop/vi/4.-transformers/" title="4 . Transformers" class="dd-item 
        parent
        
        
        ">
      <a href="/Workshop/vi/4.-transformers/">
          4 . Transformers
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/4.-transformers/4.1-create-ec2/" title="Cài đặt EC2" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/4.-transformers/4.1-create-ec2/">
          <b>4.1</b>Cài đặt EC2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/4.-transformers/4.2-setup-environment/" title="Setup Environment trên EC2" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/4.-transformers/4.2-setup-environment/">
          <b>4.2</b>Setup Environment trên EC2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/Workshop/vi/4.-transformers/4.3-training-model/" title="Training model" class="dd-item 
        
        active
        
        ">
      <a href="/Workshop/vi/4.-transformers/4.3-training-model/">
          <b>4.3</b>Training model
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/Workshop/vi/5.-clear-resources/" title="5. Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/Workshop/vi/5.-clear-resources/">
          5. Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://localhost:1313/Workshop/4.-transformers/4.3-training-model/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://localhost:1313/Workshop/vi/4.-transformers/4.3-training-model/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830891&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>26-11-2023</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/necrose01/Workshop/edit/main/4.-Transformers/4.3%20Training%20model/_index.vi.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/Workshop/vi/'>Natural Language Processing với Comprehend và Transformers</a> > <a href='/Workshop/vi/4.-transformers/'>4 . Transformers</a> > Training model
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#1-tạo-file-trainpy">1. Tạo file train.py</a></li>
    <li><a href="#2-chạy-trainpy">2. Chạy train.py</a></li>
    <li><a href="#3-kết-quả-training-model">3. Kết quả Training Model</a>
      <ul>
        <li><a href="#kết-quả-đánh-giá-mô-hình-trên-tập-test">Kết quả đánh giá mô hình trên tập test:</a></li>
      </ul>
    </li>
    <li><a href="#4-upload-nội-dung-lên-s3">4. Upload nội dung lên S3</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Training model
            </h1>
          

        



	<h2 id="1-tạo-file-trainpy">1. Tạo file train.py</h2>
<ul>
<li>Mở trình soạn thảo trên EC2 (ví dụ nano hoặc vim):</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nano train.py
</span></span></code></pre></div><p><img src="/Workshop/images/img9/step1.png" alt="step1"></p>
<ul>
<li>Giao diện văn bản nano:
<img src="/Workshop/images/img9/step2.png" alt="step2"></li>
<li>Copy Source code sau, sau đó lưu lại</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datasets <span style="color:#f92672">import</span> Dataset
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> AutoTokenizer, AutoModelForSequenceClassification, TrainingArguments, Trainer
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. Load dataset CSV</span>
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;summary_reviews_20250809T124112Z.csv&#34;</span>)  <span style="color:#75715e"># sửa tên file CSV tải từ S3</span>
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;labels&#34;</span>})  <span style="color:#75715e"># Transformers cần tên &#34;labels&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Train/Test split</span>
</span></span><span style="display:flex;"><span>train_df, test_df <span style="color:#f92672">=</span> train_test_split(df, test_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>, random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>train_dataset <span style="color:#f92672">=</span> Dataset<span style="color:#f92672">.</span>from_pandas(train_df)
</span></span><span style="display:flex;"><span>test_dataset <span style="color:#f92672">=</span> Dataset<span style="color:#f92672">.</span>from_pandas(test_df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. Load tokenizer &amp; model nhỏ cho t2.micro</span>
</span></span><span style="display:flex;"><span>model_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;distilbert-base-uncased&#34;</span>
</span></span><span style="display:flex;"><span>tokenizer <span style="color:#f92672">=</span> AutoTokenizer<span style="color:#f92672">.</span>from_pretrained(model_name)
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> AutoModelForSequenceClassification<span style="color:#f92672">.</span>from_pretrained(model_name, num_labels<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. Tokenize</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tokenize</span>(batch):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> tokenizer(batch[<span style="color:#e6db74">&#34;review&#34;</span>], padding<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, truncation<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>train_dataset <span style="color:#f92672">=</span> train_dataset<span style="color:#f92672">.</span>map(tokenize, batched<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>test_dataset <span style="color:#f92672">=</span> test_dataset<span style="color:#f92672">.</span>map(tokenize, batched<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. Training arguments</span>
</span></span><span style="display:flex;"><span>training_args <span style="color:#f92672">=</span> TrainingArguments(
</span></span><span style="display:flex;"><span>    output_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./results&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># evaluation_strategy=&#34;epoch&#34;,</span>
</span></span><span style="display:flex;"><span>    num_train_epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    per_device_train_batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    per_device_eval_batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    logging_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./logs&#34;</span>,
</span></span><span style="display:flex;"><span>    logging_steps<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6. Metrics</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score, precision_recall_fscore_support
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">compute_metrics</span>(p):
</span></span><span style="display:flex;"><span>    preds <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>predictions<span style="color:#f92672">.</span>argmax(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    precision, recall, f1, _ <span style="color:#f92672">=</span> precision_recall_fscore_support(p<span style="color:#f92672">.</span>label_ids, preds, average<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;weighted&#34;</span>)
</span></span><span style="display:flex;"><span>    acc <span style="color:#f92672">=</span> accuracy_score(p<span style="color:#f92672">.</span>label_ids, preds)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;accuracy&#34;</span>: acc, <span style="color:#e6db74">&#34;precision&#34;</span>: precision, <span style="color:#e6db74">&#34;recall&#34;</span>: recall, <span style="color:#e6db74">&#34;f1&#34;</span>: f1}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 7. Trainer</span>
</span></span><span style="display:flex;"><span>trainer <span style="color:#f92672">=</span> Trainer(
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span>model,
</span></span><span style="display:flex;"><span>    args<span style="color:#f92672">=</span>training_args,
</span></span><span style="display:flex;"><span>    train_dataset<span style="color:#f92672">=</span>train_dataset,
</span></span><span style="display:flex;"><span>    eval_dataset<span style="color:#f92672">=</span>test_dataset,
</span></span><span style="display:flex;"><span>    tokenizer<span style="color:#f92672">=</span>tokenizer,
</span></span><span style="display:flex;"><span>    compute_metrics<span style="color:#f92672">=</span>compute_metrics
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 8. Train &amp; Evaluate</span>
</span></span><span style="display:flex;"><span>trainer<span style="color:#f92672">.</span>train()
</span></span><span style="display:flex;"><span>metrics <span style="color:#f92672">=</span> trainer<span style="color:#f92672">.</span>evaluate()
</span></span><span style="display:flex;"><span>print(metrics)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 9. Save model</span>
</span></span><span style="display:flex;"><span>trainer<span style="color:#f92672">.</span>save_model(<span style="color:#e6db74">&#34;./final_model&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Model saved to ./final_model&#34;</span>)
</span></span></code></pre></div><p><img src="/Workshop/images/img9/step3.png" alt="step3"></p>
<h2 id="2-chạy-trainpy">2. Chạy train.py</h2>
<ul>
<li>Cài lại đầy đủ transformers</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install --upgrade <span style="color:#e6db74">&#34;transformers[torch]&#34;</span> accelerate
</span></span></code></pre></div><ul>
<li>Chạy lệnh sau trong thư mục chứa train.py và file CSV. Sẽ mất 1 lúc để quá trình training hoàn thành.

<div class="notices warning" ><p>Vì Instance sử dụng t2.micro rất yếu, nên nhiều trường hợp khi chạy training giữa chừng sẽ bị sập(killed). Trường hợp này cần phải nâng cấp instance type lên cao hơn và mở rộng bộ nhớ hơn. Nếu như quá trình training bị sập, hãy thử nâng cấp instance type từ từ lên như t2.medium, xong tới t2.large để giảm chi phí phát sinh. Trong trường hợp mọi instance type chi phí rẻ không thể training xong được, thì bắt buộc phải nâng cấp lên type giá cao hơn. Về căn bản chạy training model NLP vốn đã đòi hỏi CPU và GPU mạnh nên chuyện phát sinh chi phí là chuyện bắt buộc. Hoặc có thể chạy training model trên máy local nếu như máy local đủ khỏe để chạy.</p>
<p>Vì bài lab chỉ hướng dẫn cách train cho model, nên data dùng để training cũng quá ít để model có thể học, nên việc overfit là rất bình thường. Nếu như muốn traning hiệu quả thì cần đưa vào lượng lớn data trong 1 lần training, thay vì training nhỏ giọt từng data ít ỏi này.</p>
</div>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 train.py
</span></span></code></pre></div><p><img src="/Workshop/images/img9/step4.png" alt="step4"></p>
<h2 id="3-kết-quả-training-model">3. Kết quả Training Model</h2>
<p>Quá trình training mô hình phân loại văn bản với <strong>distilbert-base-uncased</strong> đã được thực hiện thành công trên EC2 instance với dataset nhỏ.</p>
<p>Mô hình đã được train đủ 3 epoch, tổng thời gian training khoảng 7.7 giây trên instance <code>t2.micro</code>.</p>
<p>Loss trong quá trình training có sự biến động, cho thấy mô hình đã học được thông tin từ dữ liệu (train_loss cuối cùng là khoảng 0.94).</p>
<p>Sau khi training, mô hình được lưu lại thành công trong thư mục <code>./final_model</code>.</p>
<h3 id="kết-quả-đánh-giá-mô-hình-trên-tập-test">Kết quả đánh giá mô hình trên tập test:</h3>
<table>
  <thead>
      <tr>
          <th>Metric</th>
          <th>Giá trị</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Loss</td>
          <td>0.875</td>
      </tr>
      <tr>
          <td>Accuracy</td>
          <td>0.5</td>
      </tr>
      <tr>
          <td>Precision</td>
          <td>0.25</td>
      </tr>
      <tr>
          <td>Recall</td>
          <td>0.5</td>
      </tr>
      <tr>
          <td>F1-score</td>
          <td>0.33</td>
      </tr>
  </tbody>
</table>

<div class="notices important" ><ul>
<li>Một số trọng số của lớp phân loại (classifier) được khởi tạo mới vì mô hình gốc chưa có phần này, nên việc train thêm trên task cụ thể là cần thiết.</li>
<li>Các cảnh báo về metric không xác định do dữ liệu nhỏ và phân bố nhãn không cân bằng, đây là hiện tượng bình thường trong các bài toán với dữ liệu giới hạn.</li>
<li>Độ chính xác và các chỉ số còn thấp, nguyên nhân chính do kích thước dataset nhỏ, tuy nhiên mô hình đã đạt được khả năng học cơ bản.</li>
<li>Quá trình training và lưu model hoàn toàn thành công, mô hình đã sẵn sàng cho các bước fine-tune hoặc inference tiếp theo.</li>
</ul>
</div>

<h2 id="4-upload-nội-dung-lên-s3">4. Upload nội dung lên S3</h2>
<ul>
<li>Upload final_model đã train xong lên S3</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws s3 cp ./final_model s3://aws-nlp-data/transformers-demo/ --recursive
</span></span></code></pre></div><p><img src="/Workshop/images/img9/step5.png" alt="step5"></p>
<ul>
<li>final_model đã được đưa lên S3, có thể download về hoặc mở ra để xem, và sử dụng, hoặc tiếp tục train.
<img src="/Workshop/images/img9/step6.png" alt="step6"></li>
</ul>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/Workshop/vi/4.-transformers/4.2-setup-environment/" title="Setup Environment trên EC2"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/Workshop/vi/5.-clear-resources/" title="5. Dọn dẹp tài nguyên" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/Workshop/js/clipboard.min.js?1754890544"></script>
    <script src="/Workshop/js/perfect-scrollbar.min.js?1754890544"></script>
    <script src="/Workshop/js/perfect-scrollbar.jquery.min.js?1754890544"></script>
    <script src="/Workshop/js/jquery.sticky.js?1754890544"></script>
    <script src="/Workshop/js/featherlight.min.js?1754890544"></script>
    <script src="/Workshop/js/highlight.pack.js?1754890544"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/Workshop/js/modernizr.custom-3.6.0.js?1754890544"></script>
    <script src="/Workshop/js/learn.js?1754890544"></script>
    <script src="/Workshop/js/hugo-learn.js?1754890544"></script>

    <link href="/Workshop/mermaid/mermaid.css?1754890544" rel="stylesheet" />
    <script src="/Workshop/mermaid/mermaid.js?1754890544"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
